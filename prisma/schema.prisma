generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  monthlyOverviewEntries MonthlyOverviewEntry[]
  walletEntries WalletEntry[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum WalletEntryType {
  CASH_WALLET
  ASSET_HOLDING
}

model MonthlyOverviewEntry {
  id           String   @id @default(dbgenerated("md5((random())::text || (clock_timestamp())::text)"))
  userId       String
  entryDate    DateTime
  walletAmount Decimal
  remarks      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, entryDate])
}

model WalletEntry {
  id                   String          @id @default(dbgenerated("md5((random())::text || (clock_timestamp())::text)"))
  userId               String
  type                 WalletEntryType
  groupName            String?
  name                 String
  currentValuePhp      Decimal
  initialInvestmentPhp Decimal?
  remarks              String?
  sortOrder            Int             @default(0)
  isArchived           Boolean         @default(false)
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  user                 User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type, sortOrder])
  @@index([userId, isArchived])
}
